<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… LitePlay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; direction: rtl; background: #f0f0f0; padding: 20px; }
    h1 { color: #7e22ce; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    button { padding: 6px 12px; margin: 4px; background-color: #7e22ce; color: white; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… LitePlay</h1>

<div id="usersTableContainer">
  <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</p>
</div>

<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  // âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø¹Ù„Ù‰ Supabase
  const supabaseUrl = 'https://tjucasaggrvtzjzbxmpm.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRqdWNhc2FnZ3J2dHpqemJ4bXBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NjAwMzksImV4cCI6MjA2NTMzNjAzOX0.V8uS4aXyMVU67EL7SLqdjz3TiL4wFIEK6n2SW6JRS9s';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function fetchUsers() {
    const { data, error } = await supabase
      .from('Liteplay')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) {
      document.getElementById('usersTableContainer').innerHTML = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
      console.error(error);
      return;
    }

    let html = '<table><tr><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>';
    data.forEach(user => {
      html += `<tr>
        <td>${user.email}</td>
        <td>${user.points}</td>
        <td>${user.message || ''}</td>
        <td>${user.status || 'Ù†Ø´Ø·'}</td>
        <td>
          <button onclick="addPoints('${user.id}', 10)">ğŸ Ù†Ù‚Ø§Ø·</button>
          <button onclick="banUser('${user.id}')">ğŸš« Ø­Ø¸Ø±</button>
          <button onclick="sendMessage('${user.id}')">ğŸ’¬ Ø±Ø³Ø§Ù„Ø©</button>
        </td>
      </tr>`;
    });
    html += '</table>';

    document.getElementById('usersTableContainer').innerHTML = html;
  }

  async function addPoints(userId, amount) {
    const { error } = await supabase
      .rpc('increment_points', { uid: userId, amount });

    if (error) alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·');
    fetchUsers();
  }

  async function banUser(userId) {
    const { error } = await supabase
      .from('Liteplay')
      .update({ status: 'Ù…Ø­Ø¸ÙˆØ±' })
      .eq('id', userId);

    if (error) alert('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø¸Ø±');
    fetchUsers();
  }

  async function sendMessage(userId) {
    const msg = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
    if (msg) {
      const { error } = await supabase
        .from('Liteplay')
        .update({ message: msg })
        .eq('id', userId);

      if (error) alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
      fetchUsers();
    }
  }

  fetchUsers();
</script>

</body>
</html>